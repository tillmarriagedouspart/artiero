// Smooth scroll for buttons and map stops
document.querySelectorAll('[data-scroll-to], .map-stops li').forEach(el => {
  el.addEventListener('click', () => {
    const targetId = el.dataset.scrollTo || el.dataset.target;
    const target = document.getElementById(targetId);
    if (target) {
      target.scrollIntoView({ behavior: 'smooth' });
    }
  });
});

// Update active stop + train position on scroll
const stops = document.querySelectorAll('.map-stops li');
const sections = Array.from(stops).map(stop => {
  const id = stop.dataset.target;
  return document.getElementById(id);
});
const track = document.querySelector('.map-track');
const train = document.querySelector('.train-indicator');

function updateTrain() {
  let activeIndex = 0;
  const scrollY = window.scrollY;
  const vh = window.innerHeight;

  sections.forEach((sec, index) => {
    const rect = sec.getBoundingClientRect();
    const top = rect.top + scrollY;
    if (scrollY + vh * 0.3 >= top) {
      activeIndex = index;
    }
  });

  stops.forEach((stop, i) => {
    stop.classList.toggle('active', i === activeIndex);
  });

  const fraction = sections.length > 1 ? activeIndex / (sections.length - 1) : 0;
  const trackWidth = track.clientWidth;
  train.style.transform = translateX(${fraction * trackWidth}px);
}

window.addEventListener('scroll', updateTrain);
window.addEventListener('resize', updateTrain);
window.addEventListener('load', updateTrain);